(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[580],{3441:function(e,t,n){"use strict";n.d(t,{g:function(){return l}});var a=n(9762),r=n(2846),c=n(5031),o=n(7294);function i(){return i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i.apply(this,arguments)}var s=["className","rows"],l=(0,r.Gp)((function(e,t){var n=(0,r.mq)("Textarea",e),l=(0,r.Lr)(e),u=l.className,d=l.rows,f=function(e,t){if(null==e)return{};var n,a,r={},c=Object.keys(e);for(a=0;a<c.length;a++)n=c[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(l,s),h=(0,a.Yp)(f),m=d?(0,c.CE)(n,["h","minH","height","minHeight"]):n;return o.createElement(r.m$.textarea,i({ref:t,rows:d},h,{className:(0,c.cx)("chakra-textarea",u),__css:m}))}));c.Ts&&(l.displayName="Textarea")},3451:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/[id]",function(){return n(6690)}])},6039:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var a=n(4051),r=n.n(a),c=n(5893),o=n(7294),i=n(8527),s=n(5321),l=n(9095),u=n.n(l),d=n(894),f=(0,d.IU)({displayName:"FavIconFavorite",viewBox:"0 0 24 24",path:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,c.jsx)("path",{d:"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"})]})}),h=(0,d.IU)({displayName:"FavIconBorder",viewBox:"0 0 24 24",path:(0,c.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",height:"24px",viewBox:"0 0 24 24",width:"24px",fill:"#000000",children:[(0,c.jsx)("path",{d:"M0 0h24v24H0V0z",fill:"none"}),(0,c.jsx)("path",{d:"M16.5 3c-1.74 0-3.41.81-4.5 2.09C10.91 3.81 9.24 3 7.5 3 4.42 3 2 5.42 2 8.5c0 3.78 3.4 6.86 8.55 11.54L12 21.35l1.45-1.32C18.6 15.36 22 12.28 22 8.5 22 5.42 19.58 3 16.5 3zm-4.4 15.55l-.1.1-.1-.1C7.14 14.24 4 11.39 4 8.5 4 6.5 5.5 5 7.5 5c1.54 0 3.04.99 3.57 2.36h1.87C13.46 5.99 14.96 5 16.5 5c2 0 3.5 1.5 3.5 3.5 0 2.89-3.14 5.74-7.9 10.05z"})]})});function m(e,t,n,a,r,c,o){try{var i=e[c](o),s=i.value}catch(l){return void n(l)}i.done?t(s):Promise.resolve(s).then(a,r)}function x(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var c=e.apply(t,n);function o(e){m(c,a,r,o,i,"next",e)}function i(e){m(c,a,r,o,i,"throw",e)}o(void 0)}))}}var v=function(e){var t=(0,o.useState)(!1),n=t[0],a=t[1],l=(0,o.useState)(0),d=l[0],m=l[1],v=(0,o.useState)(null),p=v[0],g=v[1];(0,o.useEffect)((function(){console.log("Fav=>",e),m(e.favCount),null!=e.favedUid&&x(r().mark((function t(){var n,c,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,s.ad)(),c=(0,s.IO)((0,s.hJ)(n,"favs"),(0,s.ar)("article_id","==",e.articleId),(0,s.ar)("faved_uid","==",e.favedUid)),t.next=4,(0,s.PL)(c);case 4:o=t.sent,console.log("favSnapshot.size=",o.size),a(!1),o.size>0&&o.forEach((function(e){g(e.id),a(!0)}));case 8:case"end":return t.stop()}}),t)})))()}),[e]),console.log("faved=>",n);var _=function(t){x(r().mark((function n(){var c,o,i,l,u,f;return r().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!=e.favedUid){n.next=2;break}return n.abrupt("return");case 2:if(c=(0,s.ad)(),o=1,console.log("favToggle=",t),!t){n.next=14;break}return n.next=8,(0,s.ET)((0,s.hJ)(c,"favs"),{article_id:e.articleId,faved_uid:e.favedUid});case 8:i=n.sent,a(!0),console.log("addFav=",i),g(i.id),n.next=15;break;case 14:console.log("deleteFav=",p),p&&((0,s.oe)((0,s.JU)(c,"favs",p)),o=-1,a(!1),g(null));case 15:return console.log("favCount=",d),m(d+o),l=(0,s.JU)(c,"articles",e.articleId),n.next=20,(0,s.QT)(l);case 20:if(!(u=n.sent).exists()){n.next=27;break}return f=0,void 0!=u.data().fav_count&&(f=u.data().fav_count),n.next=26,(0,s.r7)(l,{fav_count:f+o});case 26:n.sent;case 27:case"end":return n.stop()}}),n)})))()};return(0,c.jsxs)("div",{children:[n?(0,c.jsx)(i.xu,{as:f,className:u().fav,onClick:function(e){return _(!1)}}):(0,c.jsx)(i.xu,{as:h,className:u().fav,onClick:function(e){return _(!0)}}),(0,c.jsx)(i.xu,{children:d})]})}},6690:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return b}});var a=n(4051),r=n.n(a),c=n(5893),o=n(7294),i=n(1056),s=n.n(i),l=n(5321),u=(n(179),n(1163)),d=(n(8652),n(7375)),f=n(8527),h=n(4651),m=n(6723),x=n(4612),v=n(3441),p=n(9789),g=function(e){return(0,c.jsxs)("div",{children:[(0,c.jsx)("hr",{}),(0,c.jsxs)(f.M5,{h:"120px",children:[(0,c.jsx)(f.xv,{mt:2,paddingLeft:21,fontSize:"xl",fontWeight:"semibold",lineHeight:"short",children:(0,c.jsx)("b",{children:e.comment})}),(0,c.jsxs)(f.kC,{mt:2,paddingLeft:21,align:"center",children:[(0,c.jsx)(f.xv,{ml:1,fontSize:"sm",align:"center",children:(0,c.jsx)("b",{children:e.createdAt})}),e.deletable&&(0,c.jsx)(m.zx,{onClick:e.delHandler,children:"\u524a\u9664"})]})]})]})},_=n(6039);function j(e,t,n,a,r,c,o){try{var i=e[c](o),s=i.value}catch(l){return void n(l)}i.done?t(s):Promise.resolve(s).then(a,r)}function w(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var c=e.apply(t,n);function o(e){j(c,a,r,o,i,"next",e)}function i(e){j(c,a,r,o,i,"throw",e)}o(void 0)}))}}function b(){var e=(0,o.useContext)(p.S),t=(e.currentUser,e.setCurrentUser,(0,u.useRouter)()),n=(0,o.useRef)(null),a=(0,o.useRef)(null),i=(0,o.useRef)(null),j=(0,o.useState)(null),b=(j[0],j[1],(0,o.useState)("")),I=b[0],k=b[1],C=(0,o.useState)(""),S=C[0],U=C[1],y=(0,o.useState)(null),E=y[0],N=y[1],P=(0,o.useState)(""),z=P[0],O=P[1],H=(0,o.useState)(0),F=H[0],L=H[1],M=(0,o.useState)(!0),J=(M[0],M[1]),T=(0,d.qY)(),A=(T.isOpen,T.onOpen,T.onClose,o.useRef(null),(0,o.useState)([])),D=A[0],R=A[1],B=(0,o.useState)("0"),Q=(B[0],B[1]),X=(0,o.useState)([]),Y=X[0],q=X[1],V=(0,o.useContext)(p.S),W=(0,o.useState)(""),Z=W[0],K=W[1],G=(0,o.useState)(null),$=G[0],ee=G[1];(0,o.useEffect)((function(){var e=V.currentUser;null!=e&&K(e.uid),w(r().mark((function e(){var n,a,c,o,i,s,u,d,f,h,m;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.asPath.substring(t.asPath.lastIndexOf("/")+1),a=(0,l.ad)(),c=(0,l.JU)(a,"articles",n),e.next=5,(0,l.QT)(c);case 5:if(!(o=e.sent).exists()){e.next=33;break}return i=o.data(),N(i.url),k(i.title),U(i.content),O(n),ee(i.author_uid),J(!1),L(i.fav_count),s=(0,l.IO)((0,l.hJ)(a,"tags"),(0,l.ar)("article_id","==",n)),e.next=18,(0,l.PL)(s);case 18:return u=e.sent,d=[],u.forEach((function(e){console.log(e.id," => ",e.data()),d.push({id:e.id,tagName:e.data().tag_name})})),R(d),Q(i.premium_flag),f=(0,l.IO)((0,l.hJ)(a,"comments"),(0,l.ar)("article_id","==",n),(0,l.Xo)("created_at","desc")),console.log("commentsQuery:",f),e.next=27,(0,l.PL)(f);case 27:h=e.sent,m=[],h.forEach((function(e){console.log(e.id," => ",e.data());var t=function(e){var t=e.getFullYear(),n=("00"+(e.getMonth()+1)).slice(-2),a=("00"+e.getDate()).slice(-2),r=("00"+e.getHours()).slice(-2),c=("00"+e.getMinutes()).slice(-2);return"".concat(t,"/").concat(n,"/").concat(a," ").concat(r,":").concat(c)}(e.data().created_at.toDate());console.log(t),console.log(e.id),m.push({docId:e.id,commentedUid:e.data().commented_uid,articleId:e.data().article_id,comment:e.data().comment,createdAt:t})})),q(m),e.next=34;break;case 33:console.log("No such document!");case 34:case"end":return e.stop()}}),e)})))()}),[]);var te=function(){var e=w(r().mark((function e(){var t,n,a,c,o,s,u;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=i.current.value,V.currentUser.id,null!=t){e.next=5;break}return alert("\u30b3\u30e1\u30f3\u30c8\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"),e.abrupt("return");case 5:return n=(0,l.ad)(),a=new Date,e.next=9,(0,l.ET)((0,l.hJ)(n,"comments"),{article_id:z,commented_uid:Z,comment:t,created_at:a});case 9:return c=e.sent,console.log(c),i.current.value="",console.log("handleSaved"),o=(0,l.IO)((0,l.hJ)(n,"comments"),(0,l.ar)("article_id","==",z),(0,l.Xo)("created_at","desc")),console.log("commentsQuery:",o),e.next=17,(0,l.PL)(o);case 17:s=e.sent,u=[],s.forEach((function(e){console.log(e.id," => ",e.data());var t=function(e){var t=e.getFullYear(),n=("00"+(e.getMonth()+1)).slice(-2),a=("00"+e.getDate()).slice(-2),r=("00"+e.getHours()).slice(-2),c=("00"+e.getMinutes()).slice(-2);return"".concat(t,"/").concat(n,"/").concat(a," ").concat(r,":").concat(c)}(e.data().created_at.toDate());console.log(t),console.log(e.id),u.push({docId:e.id,commentedUid:e.data().commented_uid,articleId:e.data().article_id,comment:e.data().comment,createdAt:t})})),q(u);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ne=function(){var e=w(r().mark((function e(t){var n,a,c,o;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,l.ad)(),(0,l.oe)((0,l.JU)(n,"comments",t)),a=(0,l.IO)((0,l.hJ)(n,"comments"),(0,l.ar)("article_id","==",z),(0,l.Xo)("created_at","desc")),console.log("commentsQuery:",a),e.next=6,(0,l.PL)(a);case 6:c=e.sent,o=[],c.forEach((function(e){console.log(e.id," => ",e.data());var t=function(e){var t=e.getFullYear(),n=("00"+(e.getMonth()+1)).slice(-2),a=("00"+e.getDate()).slice(-2),r=("00"+e.getHours()).slice(-2),c=("00"+e.getMinutes()).slice(-2);return"".concat(t,"/").concat(n,"/").concat(a," ").concat(r,":").concat(c)}(e.data().created_at.toDate());console.log(t),console.log(e.id),o.push({docId:e.id,commentedUid:e.data().commented_uid,articleId:e.data().article_id,comment:e.data().comment,createdAt:t})})),q(o);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(f.rj,{templateColumns:"repeat(5, 1fr)",gap:6,children:[(0,c.jsx)(f.P4,{w:"100%",h:"50",bg:"blue.500"}),(0,c.jsx)(f.P4,{w:"100%",h:"10",bg:"blue.500"}),(0,c.jsx)(f.P4,{w:"100%",h:"10",bg:"blue.500",children:(0,c.jsxs)(f.Kq,{spacing:3,mt:"150px",children:[(0,c.jsxs)(f.Kq,{direction:"row",children:[(0,c.jsx)(f.xu,{minW:"660px;",children:D.length>0&&D.map((function(e){return(0,c.jsx)(f.Ct,{ml:"3",children:e.tagName},e.id)}))}),(0,c.jsx)(f.xu,{children:(0,c.jsx)(_.Z,{articleId:z,favCount:F,favedUid:Z})})]}),(0,c.jsx)("div",{children:(0,c.jsx)(f.oM,{minW:"720px",maxW:"720px",maxH:"330px",ratio:4/3,children:(0,c.jsx)(h.Ee,{borderRadius:"md",src:E,objectFit:"cover"})})}),null!=Z&&Z==$&&(0,c.jsx)(m.zx,{onClick:function(){return e=z,void t.push("/article/edit/"+e);var e},children:"\u7de8\u96c6"}),(0,c.jsx)(f.xv,{children:"\u30bf\u30a4\u30c8\u30eb"}),I,(0,c.jsx)(x.II,{placeholder:"",size:"sm",id:"title",ref:n,defaultValue:I,className:s()["title-input"]}),(0,c.jsx)(f.xv,{children:"\u672c\u6587"}),S,(0,c.jsx)(v.g,{placeholder:"Here is a sample placeholder",size:"sm",id:"content","aria-label":"minimum height",style:{width:500},ref:a,defaultValue:S}),(0,c.jsx)(f.xv,{children:"\u30b3\u30e1\u30f3\u30c8"}),(0,c.jsx)(v.g,{placeholder:"Here is a sample placeholder",size:"sm",id:"comment","aria-label":"minimum height",style:{width:500},ref:i}),(0,c.jsx)(m.zx,{onClick:te,children:"\u30b3\u30e1\u30f3\u30c8\u6295\u7a3f"}),(0,c.jsx)("div",{children:Y.length>0&&Y.map((function(e){return(0,c.jsx)(g,{docId:e.docId,articleId:e.articleId,commentedUid:e.commentedUid,comment:e.comment,createdAt:e.createdAt,deletable:Z===e.commentedUid,delHandler:function(){return ne(e.docId)}},e.docId)}))})]})})]})})}},9095:function(e){e.exports={fav:"Fav_fav__LcaAg"}},1056:function(e){e.exports={button:"_id__button___1H14","title-input":"_id__title-input__2iLZs"}},8652:function(){}},function(e){e.O(0,[612,774,888,179],(function(){return t=3451,e(e.s=t);var t}));var t=e.O();_N_E=t}]);
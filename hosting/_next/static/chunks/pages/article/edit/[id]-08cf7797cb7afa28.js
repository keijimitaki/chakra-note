(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[720],{442:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/article/edit/[id]",function(){return t(8710)}])},8710:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return S}});var r=t(4051),a=t.n(r),c=t(5893),u=t(7294),o=t(764),s=t.n(o),l=t(5321),i=(t(179),t(1153)),d=t(1163),f=function(e){console.log("props:",e.defaultValue);e.defaultValue;var n=(0,u.useState)(""),t=n[0],r=(n[1],(0,u.useState)(e.defaultValue)),a=r[0],o=r[1];(0,u.useEffect)((function(){o(e.defaultValue)}),[e.defaultValue]);var s=(0,u.useState)(""),l=s[0],d=s[1],f=(0,u.useState)(100);f[0],f[1];console.log("imageUrl:",a);return console.log("end"),(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)("div",{children:[l&&(0,c.jsx)("div",{children:l}),(0,c.jsx)("form",{onSubmit:function(e){if(e.preventDefault(),d(""),""===t)return console.log("\u30d5\u30a1\u30a4\u30eb\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093"),void d("\u30d5\u30a1\u30a4\u30eb\u304c\u9078\u629e\u3055\u308c\u3066\u3044\u307e\u305b\u3093");console.log("start"),console.log("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u51e6\u7406");var n=(0,i.cF)();console.log(t.name);var r=(0,i.iH)(n,"/images/".concat(t.name));console.log(r.name),console.log("uploadBytes",r),(0,i.KV)(r,t).then((function(e){console.log("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u6210\u529f\u3057\u307e\u3057\u305f"),(0,i.Jt)(r).then((function(e){o(e)})).catch((function(e){e.code}))})).catch((function(e){console.log("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}))},children:(0,c.jsx)("input",{type:"file",onChange:function(n){var t=n.target.files[0];e.changeImage(t);var r=URL.createObjectURL(t);o(r),d("")}})}),a&&(0,c.jsx)("div",{children:(0,c.jsx)("img",{width:"400px",src:a,alt:"uploaded"})})]})})},h=t(6930),p=(t(8652),t(7375)),x=t(8527),v=t(4612),g=t(3441),m=t(9680),j=t(6723),_=t(6129),w=t(9789);function b(e,n,t,r,a,c,u){try{var o=e[c](u),s=o.value}catch(l){return void t(l)}o.done?n(s):Promise.resolve(s).then(r,a)}function k(e){return function(){var n=this,t=arguments;return new Promise((function(r,a){var c=e.apply(n,t);function u(e){b(c,r,a,u,o,"next",e)}function o(e){b(c,r,a,u,o,"throw",e)}u(void 0)}))}}function S(){var e=(0,u.useContext)(w.S),n=(0,u.useState)(null),t=n[0],r=n[1],o=(0,u.useState)(null),b=(o[0],o[1]),S=(0,d.useRouter)(),E=(0,u.useRef)(null),P=(0,u.useRef)(null),C=(0,u.useState)(null),y=C[0],J=C[1],V=(0,u.useState)(""),O=V[0],I=V[1],N=(0,u.useState)(""),R=N[0],U=N[1],z=(0,u.useState)(null),F=z[0],T=z[1],q=(0,u.useState)(""),H=q[0],K=q[1],L=(0,u.useState)(!0),B=L[0],D=L[1],X=(0,p.qY)(),Y=X.isOpen,A=X.onOpen,Q=X.onClose,Z=u.useRef(null),G=(0,u.useState)([]),M=G[0],W=G[1],$=(0,u.useState)("0"),ee=$[0],ne=$[1];(0,u.useEffect)((function(){k(a().mark((function n(){var t,c,u,o,s,i,d,f,h,p;return a().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return null!=(t=e.currentUser)&&r(t.uid),c=S.asPath.substring(S.asPath.lastIndexOf("/")+1),u=(0,l.ad)(),o=(0,l.JU)(u,"articles",c),n.next=7,(0,l.QT)(o);case 7:if(!(s=n.sent).exists()){n.next=28;break}return i=s.data(),d=i.url,K(c),T(d),I(i.title),U(i.content),b(i.author_uid),D(!1),f=(0,l.IO)((0,l.hJ)(u,"tags"),(0,l.ar)("article_id","==",c)),console.log("q:",f),n.next=21,(0,l.PL)(f);case 21:h=n.sent,p=[],h.forEach((function(e){console.log(e.id," => ",e.data()),p.push(e.data().tag_name)})),W(p),ne(i.premium_flag),n.next=29;break;case 28:console.log("No such document!");case 29:case"end":return n.stop()}}),n)})))()}),[]);var te=(0,u.useState)(""),re=te[0],ae=te[1],ce=function(){var e=k(a().mark((function e(){var n,r,c,u,o,s,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=3;break}return alert("\u30ed\u30b0\u30a4\u30f3\u3057\u3066\u3044\u306a\u3044\u305f\u3081\u767b\u9332\u3067\u304d\u307e\u305b\u3093"),e.abrupt("return");case 3:if(n=E.current.value,r=P.current.value,null!=n&&null!=r&&null!=y){e.next=8;break}return alert("1,2,3\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"),e.abrupt("return");case 8:return c=(0,l.ad)(),u=new Date,o=(0,l.JU)((0,l.hJ)(c,"articles")),e.next=13,(0,l.pl)(o,{article_id:o.id,author_uid:t,title:E.current.value,content:P.current.value,fav_count:0,premium_flag:ee,created_at:u});case 13:s=(0,i.cF)(),d=(0,i.iH)(s,"/images/".concat(o.id)),(0,i.KV)(d,y).then((function(e){console.log("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u6210\u529f\u3057\u307e\u3057\u305f"),(0,i.Jt)(d).then((function(e){(0,l.pl)(o,{url:e},{merge:!0})})).catch((function(e){e.code,ae("\u6295\u7a3f\u3057\u307e\u3057\u305f"),J(null),I("")}))})).catch((function(e){console.log("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f")})),M.forEach(function(){var e=k(a().mark((function e(n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.ET)((0,l.hJ)(c,"tags"),{article_id:o.id,tag_name:n,created_at:u});case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),S.push("/",void 0,{shallow:!0});case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ue=function(){var e=k(a().mark((function e(){var n,t,r,c,u,o,s,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSave"),n=E.current.value,t=P.current.value,null!=n&&null!=t){e.next=6;break}return alert("\u30bf\u30a4\u30c8\u30eb\u3068\u5185\u5bb9\u3092\u8a2d\u5b9a\u3057\u3066\u304f\u3060\u3055\u3044"),e.abrupt("return");case 6:return console.log(E.current.value),console.log(P.current.value),r=(0,l.ad)(),c=(0,l.JU)(r,"articles",H),e.next=12,(0,l.r7)(c,{title:E.current.value,content:P.current.value,premium_flag:ee,timestamp:(0,l.Bt)()});case 12:return e.sent,console.log(c.id),y&&(u=(0,i.cF)(),o=(0,i.iH)(u,"/images/".concat(c.id)),console.log("uploadBytes",o),(0,i.KV)(o,y).then((function(e){console.log("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u6210\u529f\u3057\u307e\u3057\u305f"),(0,i.Jt)(o).then((function(e){(0,l.pl)(c,{url:e},{merge:!0})})).catch((function(e){e.code,ae("\u6295\u7a3f\u3057\u307e\u3057\u305f"),J(null),I("")}))})).catch((function(e){console.log("\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9\u306b\u5931\u6557\u3057\u307e\u3057\u305f")}))),s=(0,l.IO)((0,l.hJ)(r,"tags"),(0,l.ar)("article_id","==",H)),e.next=18,(0,l.PL)(s);case 18:e.sent.forEach(function(){var e=k(a().mark((function e(n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n.id," => ",n.data()),e.next=3,(0,l.oe)(n.ref);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),d=new Date,console.log(M),M.forEach(function(){var e=k(a().mark((function e(n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,l.ET)((0,l.hJ)(r,"tags"),{article_id:H,tag_name:n,created_at:d});case 2:e.sent;case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),S.push("/",void 0,{shallow:!0});case 24:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=k(a().mark((function e(){var n,t,r,c;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(0,l.ad)(),t=(0,l.IO)((0,l.hJ)(n,"tags"),(0,l.ar)("article_id","==",H)),e.next=4,(0,l.PL)(t);case 4:e.sent.forEach(function(){var e=k(a().mark((function e(n){return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n.id," => ",n.data()),e.next=3,(0,l.oe)(n.ref);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()),r=(0,i.cF)(),c=(0,i.iH)(r,"/images/".concat(H)),(0,i.oq)(c).then((function(){(0,l.oe)((0,l.JU)(n,"articles",H)),console.log("\u5199\u771f\u3068\u8a18\u4e8b\u3092\u524a\u9664\u3057\u307e\u3057\u305f")})).catch((function(e){})),S.push("/",void 0,{shallow:!0});case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,c.jsx)(c.Fragment,{children:(0,c.jsxs)(x.rj,{templateColumns:"repeat(5, 1fr)",gap:6,children:[(0,c.jsx)(x.P4,{w:"100%",h:"50",bg:"blue.500"}),(0,c.jsx)(x.P4,{w:"100%",h:"10",bg:"blue.500"}),(0,c.jsx)(x.P4,{w:"100%",h:"10",bg:"blue.500",children:(0,c.jsxs)(x.Kq,{spacing:3,mt:"100px",children:[(0,c.jsx)("div",{children:(0,c.jsx)("b",{children:"\u753b\u50cf\u30a2\u30c3\u30d7\u30ed\u30fc\u30c9"})}),(0,c.jsx)("div",{children:(0,c.jsx)(f,{changeImage:function(e){J(e)},defaultValue:F})}),(0,c.jsx)(x.xv,{children:"\u30bf\u30a4\u30c8\u30eb"}),(0,c.jsx)(v.II,{placeholder:"",size:"sm",id:"title",ref:E,defaultValue:O,className:s().eyecatch}),(0,c.jsx)(x.xv,{children:"\u672c\u6587"}),(0,c.jsx)(g.g,{placeholder:"Here is a sample placeholder",size:"sm",id:"content","aria-label":"minimum height",style:{width:500},ref:P,defaultValue:R}),(0,c.jsx)(x.xv,{children:"\u30bf\u30b0"}),(0,c.jsx)(h.Z,{tags:M,onChange:function(e){return W(e)}}),(0,c.jsx)(x.xv,{children:"\u516c\u958b\u7bc4\u56f2"}),(0,c.jsx)(m.Ee,{onChange:ne,value:ee,children:(0,c.jsxs)(x.Kq,{direction:"row",children:[(0,c.jsx)(m.Y8,{value:"1",children:"\u6709\u6599\u4f1a\u54e1\u9650\u5b9a"}),(0,c.jsx)(m.Y8,{value:"0",children:"\u3059\u3079\u3066\u306e\u30e6\u30fc\u30b6\u30fc"})]})}),(0,c.jsx)("div",{children:re}),B?(0,c.jsx)(j.zx,{className:s().button,onClick:ce,children:"\u6295\u7a3f"}):(0,c.jsx)(j.zx,{className:s().button,onClick:ue,children:"\u4fdd\u5b58"})]})}),(0,c.jsx)(x.P4,{w:"100%",h:"10",bg:"blue.500"}),(0,c.jsx)(x.P4,{w:"100%",h:"10",bg:"blue.500"}),(0,c.jsx)(j.zx,{onClick:A,children:"\u8a18\u4e8b\u524a\u9664"}),(0,c.jsxs)(_.aR,{motionPreset:"slideInBottom",leastDestructiveRef:Z,onClose:Q,isOpen:Y,isCentered:!0,children:[(0,c.jsx)(_.dh,{}),(0,c.jsxs)(_._T,{children:[(0,c.jsx)(_.iP,{children:"\u8a18\u4e8b\u3092\u524a\u9664\u3057\u307e\u3059\u304b\uff1f"}),(0,c.jsxs)(_.xo,{children:[(0,c.jsx)(j.zx,{ref:Z,onClick:Q,children:"\u3044\u3044\u3048"}),(0,c.jsx)(j.zx,{colorScheme:"red",ml:3,onClick:oe,children:"\u306f\u3044"})]})]})]})]})})}},764:function(e){e.exports={button:"_id__button__XVpEA","title-input":"_id__title-input__u8Apn"}}},function(e){e.O(0,[612,153,135,774,888,179],(function(){return n=442,e(e.s=n);var n}));var n=e.O();_N_E=n}]);